<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í•œêµ­FPì„¼í„° íšŒì› ë° ë§¤ì¶œ í†µí•© ê´€ë¦¬</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Malgun Gothic', -apple-system, BlinkMacSystemFont, sans-serif;
            background: #f5f7fa;
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        /* í—¤ë” */
        .header {
            text-align: center;
            padding: 25px;
            margin-bottom: 25px;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.08);
        }

        .header h1 {
            font-size: 1.8rem;
            color: #1a73e8;
            margin-bottom: 8px;
            font-weight: 700;
        }

        .header p {
            color: #666;
            font-size: 0.95rem;
        }

        .last-update {
            margin-top: 10px;
            font-size: 0.85rem;
            color: #888;
        }

        .refresh-btn {
            margin-top: 12px;
            padding: 8px 20px;
            border: 1px solid #1a73e8;
            border-radius: 20px;
            background: #fff;
            color: #1a73e8;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s;
        }

        .refresh-btn:hover {
            background: #1a73e8;
            color: #fff;
        }

        /* íƒ­ ë„¤ë¹„ê²Œì´ì…˜ */
        .tab-nav {
            display: flex;
            gap: 8px;
            margin-bottom: 25px;
            flex-wrap: wrap;
            justify-content: center;
            background: #fff;
            padding: 15px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
        }

        .tab-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 600;
            transition: all 0.3s;
            background: #f0f0f0;
            color: #555;
        }

        .tab-btn:hover {
            background: #e3f2fd;
            color: #1a73e8;
        }

        .tab-btn.active {
            background: #1a73e8;
            color: #fff;
            box-shadow: 0 4px 12px rgba(26,115,232,0.3);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.4s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* í†µí•© í˜„í™©íŒ ì¹´ë“œ */
        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .summary-card {
            background: #fff;
            border-radius: 16px;
            padding: 24px;
            text-align: center;
            box-shadow: 0 2px 12px rgba(0,0,0,0.08);
            transition: transform 0.3s, box-shadow 0.3s;
            border-top: 4px solid #ddd;
        }

        .summary-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 24px rgba(0,0,0,0.12);
        }

        .summary-card .icon {
            font-size: 2.5rem;
            margin-bottom: 12px;
        }

        .summary-card h3 {
            font-size: 0.85rem;
            color: #888;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .summary-card .value {
            font-size: 2rem;
            font-weight: 700;
            color: #333;
        }

        .summary-card .sub-value {
            font-size: 0.8rem;
            color: #aaa;
            margin-top: 4px;
        }

        .card-membership { border-top-color: #e74c3c; }
        .card-membership .value { color: #e74c3c; }
        
        .card-branch { border-top-color: #3498db; }
        .card-branch .value { color: #3498db; }
        
        .card-corporate { border-top-color: #9b59b6; }
        .card-corporate .value { color: #9b59b6; }
        
        .card-consultant { border-top-color: #27ae60; }
        .card-consultant .value { color: #27ae60; }
        
        .card-revenue { border-top-color: #f39c12; }
        .card-revenue .value { color: #f39c12; }

        /* ê²€ìƒ‰ ì˜ì—­ */
        .search-section {
            background: #fff;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
        }

        .search-row {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            align-items: center;
        }

        .search-input {
            flex: 1;
            min-width: 200px;
            padding: 12px 18px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            background: #fff;
            color: #333;
            font-size: 0.95rem;
            transition: border-color 0.3s;
        }

        .search-input::placeholder {
            color: #aaa;
        }

        .search-input:focus {
            outline: none;
            border-color: #1a73e8;
        }

        .search-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            background: #1a73e8;
            color: #fff;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .search-btn:hover {
            background: #1557b0;
            box-shadow: 0 4px 12px rgba(26,115,232,0.3);
        }

        .filter-select {
            padding: 12px 18px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            background: #fff;
            color: #333;
            font-size: 0.95rem;
            cursor: pointer;
        }

        .filter-select:focus {
            outline: none;
            border-color: #1a73e8;
        }

        /* í…Œì´ë¸” ìŠ¤íƒ€ì¼ */
        .table-container {
            background: #fff;
            border-radius: 12px;
            overflow: hidden;
            margin-bottom: 25px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.08);
        }

        .table-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 20px;
            background: #f8f9fa;
            border-bottom: 1px solid #eee;
        }

        .table-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #333;
        }

        .table-count {
            background: #e3f2fd;
            color: #1a73e8;
            padding: 5px 14px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
        }

        .data-table th {
            background: #f8f9fa;
            padding: 14px 16px;
            text-align: left;
            font-weight: 600;
            color: #555;
            font-size: 0.85rem;
            border-bottom: 2px solid #eee;
            cursor: pointer;
            user-select: none;
            position: relative;
            transition: background 0.2s;
        }

        .data-table th:hover {
            background: #e9ecef;
        }

        .data-table th .sort-icon {
            margin-left: 5px;
            font-size: 0.75rem;
            color: #aaa;
        }

        .data-table th.sort-asc .sort-icon::after {
            content: 'â–²';
            color: #1a73e8;
        }

        .data-table th.sort-desc .sort-icon::after {
            content: 'â–¼';
            color: #1a73e8;
        }

        .data-table th:not(.sort-asc):not(.sort-desc) .sort-icon::after {
            content: 'â‡…';
        }

        .data-table td {
            padding: 14px 16px;
            border-bottom: 1px solid #f0f0f0;
            font-size: 0.9rem;
            color: #444;
        }

        .data-table tr:hover {
            background: #f8fbff;
        }

        .table-scroll {
            max-height: 450px;
            overflow-y: auto;
        }

        .table-scroll::-webkit-scrollbar {
            width: 8px;
        }

        .table-scroll::-webkit-scrollbar-track {
            background: #f0f0f0;
        }

        .table-scroll::-webkit-scrollbar-thumb {
            background: #ccc;
            border-radius: 4px;
        }

        .table-scroll::-webkit-scrollbar-thumb:hover {
            background: #aaa;
        }

        /* ì°¨íŠ¸ ì˜ì—­ */
        .chart-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .chart-card {
            background: #fff;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.08);
        }

        .chart-card h3 {
            color: #333;
            margin-bottom: 16px;
            font-size: 1rem;
            font-weight: 600;
        }

        .chart-container {
            position: relative;
            height: 280px;
        }

        /* ë°°ì§€ */
        .badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .badge-membership { background: #fdeaea; color: #e74c3c; }
        .badge-branch { background: #e8f4fc; color: #3498db; }
        .badge-corporate { background: #f4ecf7; color: #9b59b6; }
        .badge-consultant { background: #e8f8f0; color: #27ae60; }

        /* í†µí•© ê²€ìƒ‰ ê²°ê³¼ */
        .search-results {
            margin-top: 20px;
        }

        .result-group {
            margin-bottom: 20px;
            background: #fff;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
        }

        .result-group-title {
            font-size: 1rem;
            font-weight: 600;
            color: #333;
            padding: 14px 20px;
            background: #f8f9fa;
            border-bottom: 1px solid #eee;
        }

        /* ë°˜ì‘í˜• */
        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.4rem;
            }

            .tab-btn {
                padding: 8px 14px;
                font-size: 0.8rem;
            }

            .summary-card .value {
                font-size: 1.6rem;
            }

            .chart-grid {
                grid-template-columns: 1fr;
            }

            .data-table th, .data-table td {
                padding: 10px 12px;
                font-size: 0.8rem;
            }
        }

        /* ë§¤ì¶œ ìš”ì•½ ì¹´ë“œ */
        .revenue-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 16px;
            margin-bottom: 25px;
        }

        .revenue-card {
            background: #fff;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
            border-left: 4px solid #f39c12;
        }

        .revenue-card h4 {
            color: #888;
            font-size: 0.85rem;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .revenue-card .amount {
            font-size: 1.5rem;
            font-weight: 700;
            color: #f39c12;
        }

        /* ê¸ˆì•¡ ê°•ì¡° */
        .money {
            font-weight: 600;
            color: #2ecc71;
        }

        /* ë¹ˆ ìƒíƒœ */
        .empty-state {
            text-align: center;
            padding: 40px;
            color: #aaa;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- í—¤ë” -->
        <div class="header">
            <h1>ğŸ“Š í•œêµ­FPì„¼í„° íšŒì› ë° ë§¤ì¶œ í†µí•© ê´€ë¦¬</h1>
            <p>ë©¤ë²„ì‹­ Â· ì§€ì‚¬ Â· ê¸°ì—… Â· ì»¨ì„¤í„´íŠ¸ íšŒì› í˜„í™© ë° ë§¤ì¶œ ë¶„ì„</p>
            <div class="last-update">ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: <span id="lastUpdate">-</span></div>
            <button class="refresh-btn" onclick="loadAllData()">ğŸ”„ ìƒˆë¡œê³ ì¹¨</button>
        </div>

        <!-- íƒ­ ë„¤ë¹„ê²Œì´ì…˜ -->
        <div class="tab-nav">
            <button class="tab-btn active" data-tab="dashboard">ğŸ“ˆ í†µí•© í˜„í™©íŒ</button>
            <button class="tab-btn" data-tab="membership">ğŸ¯ ë©¤ë²„ì‹­</button>
            <button class="tab-btn" data-tab="branch">ğŸ¢ ì§€ì‚¬</button>
            <button class="tab-btn" data-tab="corporate">ğŸ›ï¸ ê¸°ì—…</button>
            <button class="tab-btn" data-tab="consultant">ğŸ‘” ì»¨ì„¤í„´íŠ¸</button>
            <button class="tab-btn" data-tab="revenue">ğŸ’° ë§¤ì¶œ</button>
            <button class="tab-btn" data-tab="search">ğŸ” í†µí•©ê²€ìƒ‰</button>
        </div>

        <!-- íƒ­ ì»¨í…ì¸ : í†µí•© í˜„í™©íŒ -->
        <div id="dashboard" class="tab-content active">
            <div class="summary-grid">
                <div class="summary-card card-membership">
                    <div class="icon">ğŸ¯</div>
                    <h3>ë©¤ë²„ì‹­ íšŒì› (ì´ë„ˆì„œí´)</h3>
                    <div class="value" id="membershipCount">-</div>
                    <div class="sub-value">ëª…</div>
                </div>
                <div class="summary-card card-branch">
                    <div class="icon">ğŸ¢</div>
                    <h3>ì§€ì‚¬</h3>
                    <div class="value" id="branchCount">-</div>
                    <div class="sub-value">ê°œ</div>
                </div>
                <div class="summary-card card-corporate">
                    <div class="icon">ğŸ›ï¸</div>
                    <h3>ê¸°ì—… í™ˆí˜ì´ì§€</h3>
                    <div class="value" id="corporateCount">-</div>
                    <div class="sub-value">ê°œ</div>
                </div>
                <div class="summary-card card-consultant">
                    <div class="icon">ğŸ‘”</div>
                    <h3>ì»¨ì„¤í„´íŠ¸ í™ˆí˜ì´ì§€</h3>
                    <div class="value" id="consultantCount">-</div>
                    <div class="sub-value">ëª…</div>
                </div>
                <div class="summary-card card-revenue">
                    <div class="icon">ğŸ’°</div>
                    <h3>ì´ ë§¤ì¶œ</h3>
                    <div class="value" id="totalRevenue">-</div>
                    <div class="sub-value">ëˆ„ì  ê²°ì œê¸ˆì•¡</div>
                </div>
            </div>

            <div class="chart-grid">
                <div class="chart-card">
                    <h3>ğŸ“Š íšŒì› ìœ í˜•ë³„ ë¶„í¬</h3>
                    <div class="chart-container">
                        <canvas id="memberDistChart"></canvas>
                    </div>
                </div>
                <div class="chart-card">
                    <h3>ğŸ“ˆ ì›”ë³„ ë§¤ì¶œ ì¶”ì´</h3>
                    <div class="chart-container">
                        <canvas id="revenueChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- íƒ­ ì»¨í…ì¸ : ë©¤ë²„ì‹­ íšŒì› -->
        <div id="membership" class="tab-content">
            <div class="search-section">
                <div class="search-row">
                    <input type="text" class="search-input" id="membershipSearch" placeholder="ì„±ëª… ë˜ëŠ” ëª¨ë°”ì¼ë¡œ ê²€ìƒ‰...">
                    <select class="filter-select" id="membershipFilter">
                        <option value="all">ì „ì²´ êµ¬ë¶„</option>
                    </select>
                    <button class="search-btn" onclick="filterMembership()">ê²€ìƒ‰</button>
                </div>
            </div>
            <div class="table-container">
                <div class="table-header">
                    <span class="table-title">ğŸ¯ ë©¤ë²„ì‹­ íšŒì› (ì´ë„ˆì„œí´) ëª©ë¡</span>
                    <span class="table-count" id="membershipTableCount">0ëª…</span>
                </div>
                <div class="table-scroll">
                    <table class="data-table" id="membershipTable">
                        <thead>
                            <tr>
                                <th onclick="sortTable('membership', 'no')">No<span class="sort-icon"></span></th>
                                <th onclick="sortTable('membership', 'name')">ì´ë¦„<span class="sort-icon"></span></th>
                                <th onclick="sortTable('membership', 'company')">íšŒì‚¬ëª…<span class="sort-icon"></span></th>
                                <th onclick="sortTable('membership', 'mobile')">ì „í™”ë²ˆí˜¸<span class="sort-icon"></span></th>
                                <th onclick="sortTable('membership', 'promotion')">ë¹„ê³ <span class="sort-icon"></span></th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- íƒ­ ì»¨í…ì¸ : ì§€ì‚¬ -->
        <div id="branch" class="tab-content">
            <div class="search-section">
                <div class="search-row">
                    <input type="text" class="search-input" id="branchSearch" placeholder="ì„±ëª… ë˜ëŠ” ëª¨ë°”ì¼ë¡œ ê²€ìƒ‰...">
                    <button class="search-btn" onclick="filterBranch()">ê²€ìƒ‰</button>
                </div>
            </div>
            <div class="table-container">
                <div class="table-header">
                    <span class="table-title">ğŸ¢ ì§€ì‚¬ ëª©ë¡</span>
                    <span class="table-count" id="branchTableCount">0ê°œ</span>
                </div>
                <div class="table-scroll">
                    <table class="data-table" id="branchTable">
                        <thead>
                            <tr>
                                <th onclick="sortTable('branch', 'no')">No<span class="sort-icon"></span></th>
                                <th onclick="sortTable('branch', 'name')">ì„±ëª…<span class="sort-icon"></span></th>
                                <th onclick="sortTable('branch', 'mobile')">ëª¨ë°”ì¼<span class="sort-icon"></span></th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- íƒ­ ì»¨í…ì¸ : ê¸°ì—… í™ˆí˜ì´ì§€ -->
        <div id="corporate" class="tab-content">
            <div class="search-section">
                <div class="search-row">
                    <input type="text" class="search-input" id="corporateSearch" placeholder="íšŒì‚¬ëª… ë˜ëŠ” ë‹´ë‹¹ì ê²€ìƒ‰...">
                    <button class="search-btn" onclick="filterCorporate()">ê²€ìƒ‰</button>
                </div>
            </div>
            <div class="table-container">
                <div class="table-header">
                    <span class="table-title">ğŸ›ï¸ ê¸°ì—… í™ˆí˜ì´ì§€ ëª©ë¡</span>
                    <span class="table-count" id="corporateTableCount">0ê°œ</span>
                </div>
                <div class="table-scroll">
                    <table class="data-table" id="corporateTable">
                        <thead>
                            <tr>
                                <th onclick="sortTable('corporate', 'no')">No<span class="sort-icon"></span></th>
                                <th onclick="sortTable('corporate', 'company')">íšŒì‚¬ëª…<span class="sort-icon"></span></th>
                                <th onclick="sortTable('corporate', 'name')">ë‹´ë‹¹ì<span class="sort-icon"></span></th>
                                <th onclick="sortTable('corporate', 'mobile')">ì „í™”ë²ˆí˜¸<span class="sort-icon"></span></th>
                                <th onclick="sortTable('corporate', 'promotion')">ë¹„ê³ <span class="sort-icon"></span></th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- íƒ­ ì»¨í…ì¸ : ì»¨ì„¤í„´íŠ¸ -->
        <div id="consultant" class="tab-content">
            <div class="search-section">
                <div class="search-row">
                    <input type="text" class="search-input" id="consultantSearch" placeholder="ì„±ëª… ë˜ëŠ” ì†Œì†ì‚¬ ê²€ìƒ‰...">
                    <select class="filter-select" id="consultantCompanyFilter">
                        <option value="all">ì „ì²´ ì†Œì†ì‚¬</option>
                    </select>
                    <button class="search-btn" onclick="filterConsultant()">ê²€ìƒ‰</button>
                </div>
            </div>
            <div class="table-container">
                <div class="table-header">
                    <span class="table-title">ğŸ‘” ì»¨ì„¤í„´íŠ¸ í™ˆí˜ì´ì§€ ëª©ë¡</span>
                    <span class="table-count" id="consultantTableCount">0ëª…</span>
                </div>
                <div class="table-scroll">
                    <table class="data-table" id="consultantTable">
                        <thead>
                            <tr>
                                <th onclick="sortTable('consultant', 'no')">No<span class="sort-icon"></span></th>
                                <th onclick="sortTable('consultant', 'name')">ì´ë¦„<span class="sort-icon"></span></th>
                                <th onclick="sortTable('consultant', 'company')">íšŒì‚¬ëª…<span class="sort-icon"></span></th>
                                <th onclick="sortTable('consultant', 'mobile')">ì „í™”ë²ˆí˜¸<span class="sort-icon"></span></th>
                                <th onclick="sortTable('consultant', 'promotion')">ë¹„ê³ <span class="sort-icon"></span></th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- íƒ­ ì»¨í…ì¸ : ë§¤ì¶œ ë¶„ì„ -->
        <div id="revenue" class="tab-content">
            <div class="revenue-summary">
                <div class="revenue-card">
                    <h4>ğŸ’µ ì´ ë§¤ì¶œ</h4>
                    <div class="amount" id="revenueTotalAmount">-</div>
                </div>
                <div class="revenue-card">
                    <h4>ğŸ“ ì´ ê±°ë˜ ê±´ìˆ˜</h4>
                    <div class="amount" id="revenueTransCount">-</div>
                </div>
                <div class="revenue-card">
                    <h4>ğŸ“Š í‰ê·  ê²°ì œê¸ˆì•¡</h4>
                    <div class="amount" id="revenueAvgAmount">-</div>
                </div>
            </div>

            <div class="chart-grid">
                <div class="chart-card">
                    <h3>ğŸ“Š ìƒí’ˆë³„ ë§¤ì¶œ ë¶„í¬</h3>
                    <div class="chart-container">
                        <canvas id="productChart"></canvas>
                    </div>
                </div>
                <div class="chart-card">
                    <h3>ğŸ’³ ê²°ì œìœ í˜•ë³„ í˜„í™©</h3>
                    <div class="chart-container">
                        <canvas id="paymentTypeChart"></canvas>
                    </div>
                </div>
            </div>

            <div class="search-section">
                <div class="search-row">
                    <input type="text" class="search-input" id="revenueSearch" placeholder="ì„±ëª… ë˜ëŠ” ìƒí’ˆëª… ê²€ìƒ‰...">
                    <select class="filter-select" id="revenueProductFilter">
                        <option value="all">ì „ì²´ ìƒí’ˆ</option>
                    </select>
                    <button class="search-btn" onclick="filterRevenue()">ê²€ìƒ‰</button>
                </div>
            </div>
            <div class="table-container">
                <div class="table-header">
                    <span class="table-title">ğŸ’° ë§¤ì¶œ ìƒì„¸ ë‚´ì—­</span>
                    <span class="table-count" id="revenueTableCount">0ê±´</span>
                </div>
                <div class="table-scroll">
                    <table class="data-table" id="revenueTable">
                        <thead>
                            <tr>
                                <th onclick="sortTable('revenue', 'no')">No<span class="sort-icon"></span></th>
                                <th onclick="sortTable('revenue', 'date')">ì¼ì<span class="sort-icon"></span></th>
                                <th onclick="sortTable('revenue', 'name')">ì„±ëª…<span class="sort-icon"></span></th>
                                <th onclick="sortTable('revenue', 'type')">ê²°ì œìœ í˜•<span class="sort-icon"></span></th>
                                <th onclick="sortTable('revenue', 'product')">ìƒí’ˆ<span class="sort-icon"></span></th>
                                <th onclick="sortTable('revenue', 'amount')">ê²°ì œê¸ˆì•¡<span class="sort-icon"></span></th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- íƒ­ ì»¨í…ì¸ : í†µí•© ê²€ìƒ‰ -->
        <div id="search" class="tab-content">
            <div class="search-section">
                <div class="search-row">
                    <input type="text" class="search-input" id="globalSearch" placeholder="ì„±ëª…ìœ¼ë¡œ ì „ì²´ ì‹œíŠ¸ ê²€ìƒ‰...">
                    <button class="search-btn" onclick="performGlobalSearch()">ğŸ” í†µí•© ê²€ìƒ‰</button>
                </div>
            </div>
            <div class="search-results" id="globalSearchResults">
                <div class="empty-state">ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ê³  ê²€ìƒ‰ ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”.</div>
            </div>
        </div>
    </div>

    <script>
        // ========== ì„¤ì • ==========
        const SHEETS_CONFIG = {
            paymentDB: {
                id: '1dFbVzxDv-77bNdMEM2oe-xiRRPndBXQ6WEWKkFf3cjY',
                gid: '0',
                name: 'íšŒì› DB'
            },
            branch: {
                id: '1kYb9zWmUPg1kk-dT_Em5bX_vpYeOSosPAQrxkT-l8FI',
                gid: '1488154461',
                name: 'ì§€ì‚¬'
            }
        };

        // ë§¤ì¶œ ì‹œíŠ¸ ì„¤ì • (ì›”ë³„ë¡œ ì¶”ê°€ - ì¡´ì¬í•˜ëŠ” ì‹œíŠ¸ë§Œ ì…ë ¥)
        const REVENUE_SHEETS = {
            id: '1tWuYYz_dXLCupf1D4GqbmTq4LZjoFUH5SDppJBTh44M',
            sheets: ['2601ë§¤ì¶œ']  // ìƒˆ ì›” ì¶”ê°€ ì‹œ ì—¬ê¸°ì— ì¶”ê°€: '2602ë§¤ì¶œ', '2603ë§¤ì¶œ' ë“±
        };

        // ë‚ ì§œ í˜•ì‹ ê²€ì¦ í•¨ìˆ˜ (ì‹¤ì œ ë‚ ì§œì¸ì§€ í™•ì¸)
        function isValidDate(value) {
            if (!value) return false;
            // Date ê°ì²´ì¸ ê²½ìš°
            if (value instanceof Date) return true;
            
            const str = String(value).trim();
            
            // Google Sheets Date ê°ì²´ í˜•ì‹: "Date(2026,0,2)"
            if (/^Date\(\d+,\d+,\d+\)$/.test(str)) return true;
            
            // "1ì›”", "2ì›”" ê°™ì€ ì›” í‘œì‹œëŠ” ì œì™¸
            if (/^\d{1,2}ì›”$/.test(str)) return false;
            // ìˆ«ìë§Œ ìˆëŠ” ê²½ìš° ì œì™¸ (ì—°ë„ ë“±)
            if (/^\d{4}$/.test(str)) return false;
            // ë‚ ì§œ íŒ¨í„´ í™•ì¸
            return /^\d{1,2}[\/\-\.]\d{1,2}/.test(str) || /^\d{4}[\/\-\.]\d{1,2}[\/\-\.]\d{1,2}/.test(str);
        }
        
        // Date ë¬¸ìì—´ì„ ì½ê¸° ì¢‹ì€ í˜•ì‹ìœ¼ë¡œ ë³€í™˜
        function formatDateValue(value) {
            if (!value) return '-';
            const str = String(value).trim();
            
            // "Date(2026,0,2)" í˜•ì‹ íŒŒì‹±
            const match = str.match(/^Date\((\d+),(\d+),(\d+)\)$/);
            if (match) {
                const year = match[1];
                const month = parseInt(match[2]) + 1; // ì›”ì€ 0ë¶€í„° ì‹œì‘
                const day = match[3];
                return `${year}-${String(month).padStart(2,'0')}-${String(day).padStart(2,'0')}`;
            }
            
            return str;
        }

        // ========== ë°ì´í„° ì €ì¥ì†Œ ==========
        let allData = {
            membership: [],
            branch: [],
            corporate: [],
            consultant: [],
            revenue: []
        };

        let charts = {};

        // ========== íƒ­ ê¸°ëŠ¥ ==========
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                btn.classList.add('active');
                document.getElementById(btn.dataset.tab).classList.add('active');
            });
        });

        // ========== Google Sheets API í˜¸ì¶œ ==========
        async function fetchSheetData(sheetId, sheetNameOrGid, isGid = false) {
            let url;
            if (isGid) {
                url = `https://docs.google.com/spreadsheets/d/${sheetId}/gviz/tq?tqx=out:json&gid=${sheetNameOrGid}`;
            } else {
                url = `https://docs.google.com/spreadsheets/d/${sheetId}/gviz/tq?tqx=out:json&sheet=${encodeURIComponent(sheetNameOrGid)}`;
            }
            
            try {
                const response = await fetch(url);
                const text = await response.text();
                
                const jsonStart = text.indexOf('{');
                const jsonEnd = text.lastIndexOf('}') + 1;
                const jsonStr = text.substring(jsonStart, jsonEnd);
                const data = JSON.parse(jsonStr);
                
                if (!data.table || !data.table.rows) {
                    return [];
                }

                // í—¤ë” ê°€ì ¸ì˜¤ê¸° (labelì´ ë¹„ì–´ìˆìœ¼ë©´ id ì‚¬ìš©)
                const headers = data.table.cols.map((col, idx) => {
                    if (col.label && col.label.trim() !== '') {
                        return col.label;
                    }
                    return `col_${idx}`;
                });
                
                console.log('í—¤ë” í™•ì¸:', headers.slice(0, 15));

                const rows = data.table.rows.map(row => {
                    const rowData = {};
                    if (row.c) {
                        row.c.forEach((cell, idx) => {
                            if (idx < headers.length) {
                                rowData[headers[idx]] = cell ? (cell.v !== null ? cell.v : '') : '';
                            }
                        });
                    }
                    return rowData;
                });

                return rows;
            } catch (error) {
                console.error(`Error fetching sheet:`, error);
                return [];
            }
        }

        // ========== ë°ì´í„° ë¡œë“œ ==========
        async function loadAllData() {
            try {
                // paymentDBì™€ ì§€ì‚¬ ë°ì´í„° ë¡œë“œ
                const [paymentDB, branch] = await Promise.all([
                    fetchSheetData(SHEETS_CONFIG.paymentDB.id, SHEETS_CONFIG.paymentDB.gid, true),
                    fetchSheetData(SHEETS_CONFIG.branch.id, SHEETS_CONFIG.branch.gid, true)
                ]);

                // ë§¤ì¶œ ì‹œíŠ¸ ì—¬ëŸ¬ ê°œ ë¡œë“œ (ì¡´ì¬í•˜ëŠ” ì‹œíŠ¸ë§Œ)
                const revenuePromises = REVENUE_SHEETS.sheets.map(sheet => 
                    fetchSheetData(REVENUE_SHEETS.id, sheet).catch(() => [])
                );
                const revenueResults = await Promise.all(revenuePromises);
                
                // ëª¨ë“  ë§¤ì¶œ ë°ì´í„° ë³‘í•© ë° ë‚ ì§œê°€ ìˆëŠ” í–‰ë§Œ í•„í„°ë§
                const rawRevenue = revenueResults.flat();
                console.log('=== ë§¤ì¶œ ë””ë²„ê¹… ===');
                console.log('ì›ë³¸ ë°ì´í„° ê°œìˆ˜:', rawRevenue.length);
                
                const allRevenue = rawRevenue.filter(row => {
                    const dateVal = row['ì¼ì'];
                    const isValid = isValidDate(dateVal);
                    return isValid;
                });
                
                console.log('í•„í„°ë§ í›„ ê°œìˆ˜:', allRevenue.length);

                // paymentDB ë””ë²„ê¹…
                console.log('=== paymentDB ë””ë²„ê¹… ===');
                console.log('paymentDB ì›ë³¸ ê°œìˆ˜:', paymentDB.length);
                if (paymentDB.length > 0) {
                    console.log('ì²« ë²ˆì§¸ í–‰:', paymentDB[0]);
                    console.log('ì»¬ëŸ¼ëª… ëª©ë¡:', Object.keys(paymentDB[0]));
                }

                // paymentDBì—ì„œ membership ìœ í˜•ë³„ë¡œ ë¶„ë¥˜
                const membership = paymentDB.filter(row => {
                    const membershipType = row['membership'] || '';
                    return membershipType === 'inner_circle';
                });

                const corporate = paymentDB.filter(row => {
                    const membershipType = row['membership'] || '';
                    return membershipType === 'cor_home';
                });

                const consultant = paymentDB.filter(row => {
                    const membershipType = row['membership'] || '';
                    return membershipType === 'con_home';
                });

                console.log('=== íšŒì› ë¶„ë¥˜ ê²°ê³¼ ===');
                console.log('ì´ë„ˆì„œí´:', membership.length);
                console.log('ê¸°ì—… í™ˆí˜ì´ì§€:', corporate.length);
                console.log('ì»¨ì„¤í„´íŠ¸:', consultant.length);

                // ì§€ì‚¬: Aì—´(ã„±)ì— ë²ˆí˜¸ê°€ ìˆëŠ” ë°ì´í„°ë§Œ í•„í„°ë§, í—¤ë” ì œì™¸
                console.log('=== ì§€ì‚¬ ë””ë²„ê¹… ===');
                console.log('ì§€ì‚¬ ì›ë³¸ ê°œìˆ˜:', branch.length);
                
                const filteredBranch = branch.filter(row => {
                    const num = row['ã„±'] || '';
                    return num && !isNaN(num) && String(num).trim() !== '';
                });

                allData.membership = membership;
                allData.branch = filteredBranch;
                allData.corporate = corporate;
                allData.consultant = consultant;
                allData.revenue = allRevenue;

                console.log('ë§¤ì¶œ ë°ì´í„° (í•„í„°ë§ í›„):', allRevenue.length, 'ê±´');

                // UI ì—…ë°ì´íŠ¸
                updateDashboard();
                updateMembershipTable();
                updateBranchTable();
                updateCorporateTable();
                updateConsultantTable();
                updateRevenueTable();
                updateFilters();
                updateCharts();

                document.getElementById('lastUpdate').textContent = new Date().toLocaleString('ko-KR');
            } catch (error) {
                console.error('ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
            }
        }

        // ========== ëŒ€ì‹œë³´ë“œ ì—…ë°ì´íŠ¸ ==========
        function updateDashboard() {
            document.getElementById('membershipCount').textContent = allData.membership.length.toLocaleString();
            document.getElementById('branchCount').textContent = allData.branch.length.toLocaleString();
            document.getElementById('corporateCount').textContent = allData.corporate.length.toLocaleString();
            document.getElementById('consultantCount').textContent = allData.consultant.length.toLocaleString();

            const totalRevenue = allData.revenue.reduce((sum, row) => {
                const amount = parseFloat(String(row['ì´ ê²°ì œê¸ˆì•¡\n(ì¹´ë“œë°ì†¡ê¸ˆ)'] || '0').replace(/[,ì›]/g, '')) || 0;
                return sum + amount;
            }, 0);
            document.getElementById('totalRevenue').textContent = formatCurrency(totalRevenue);
        }

        // ========== í…Œì´ë¸” ì—…ë°ì´íŠ¸ ==========
        function updateMembershipTable(data = null) {
            const tableData = data || allData.membership;
            const tbody = document.querySelector('#membershipTable tbody');
            
            tbody.innerHTML = tableData.map((row, idx) => {
                // paymentDB ì»¬ëŸ¼: name, promotion, company_name, mobile
                const name = row['name'] || '-';
                const promotion = row['promotion'] || '-';
                const companyName = row['company_name'] || '-';
                const mobile = row['mobile'] || '-';
                
                return `
                <tr>
                    <td>${idx + 1}</td>
                    <td>${name}</td>
                    <td>${companyName}</td>
                    <td>${mobile}</td>
                    <td>${promotion}</td>
                </tr>
            `}).join('');

            document.getElementById('membershipTableCount').textContent = `${tableData.length}ëª…`;
        }

        function updateBranchTable(data = null) {
            const tableData = data || allData.branch;
            const tbody = document.querySelector('#branchTable tbody');
            
            tbody.innerHTML = tableData.map((row, idx) => {
                const name = row['ì„±ëª…'] || '-';
                const mobile = row['mobile'] || '-';
                
                return `
                <tr>
                    <td>${idx + 1}</td>
                    <td>${name}</td>
                    <td>${mobile}</td>
                </tr>
            `}).join('');

            document.getElementById('branchTableCount').textContent = `${tableData.length}ê°œ`;
        }

        function updateCorporateTable(data = null) {
            const tableData = data || allData.corporate;
            const tbody = document.querySelector('#corporateTable tbody');
            
            tbody.innerHTML = tableData.map((row, idx) => {
                // paymentDB ì»¬ëŸ¼: name, promotion, company_name, mobile
                const name = row['name'] || '-';
                const companyName = row['company_name'] || '-';
                const mobile = row['mobile'] || '-';
                const promotion = row['promotion'] || '-';
                
                return `
                <tr>
                    <td>${idx + 1}</td>
                    <td>${companyName}</td>
                    <td>${name}</td>
                    <td>${mobile}</td>
                    <td>${promotion}</td>
                </tr>
            `}).join('');

            document.getElementById('corporateTableCount').textContent = `${tableData.length}ê°œ`;
        }

        function updateConsultantTable(data = null) {
            const tableData = data || allData.consultant;
            const tbody = document.querySelector('#consultantTable tbody');
            
            tbody.innerHTML = tableData.map((row, idx) => {
                // paymentDB ì»¬ëŸ¼: name, promotion, company_name, mobile
                const name = row['name'] || '-';
                const companyName = row['company_name'] || '-';
                const mobile = row['mobile'] || '-';
                const promotion = row['promotion'] || '-';
                
                return `
                <tr>
                    <td>${idx + 1}</td>
                    <td>${name}</td>
                    <td>${companyName}</td>
                    <td>${mobile}</td>
                    <td>${promotion}</td>
                </tr>
            `}).join('');

            document.getElementById('consultantTableCount').textContent = `${tableData.length}ëª…`;
        }

        function updateRevenueTable(data = null) {
            const tableData = data || allData.revenue;
            const tbody = document.querySelector('#revenueTable tbody');
            
            tbody.innerHTML = tableData.map((row, idx) => `
                <tr>
                    <td>${idx + 1}</td>
                    <td>${formatDateValue(row['ì¼ì'])}</td>
                    <td>${row['ì„±ëª…'] || '-'}</td>
                    <td>${row['ê²°ì œìœ í˜•'] || '-'}</td>
                    <td>${row['ìƒí’ˆ'] || '-'}</td>
                    <td class="money">${formatCurrency(row['ì´ ê²°ì œê¸ˆì•¡\n(ì¹´ë“œë°ì†¡ê¸ˆ)'] || 0)}</td>
                </tr>
            `).join('');

            document.getElementById('revenueTableCount').textContent = `${tableData.length}ê±´`;

            const total = tableData.reduce((sum, row) => {
                const amount = parseFloat(String(row['ì´ ê²°ì œê¸ˆì•¡\n(ì¹´ë“œë°ì†¡ê¸ˆ)'] || '0').replace(/[,ì›]/g, '')) || 0;
                return sum + amount;
            }, 0);
            const avg = tableData.length > 0 ? total / tableData.length : 0;

            document.getElementById('revenueTotalAmount').textContent = formatCurrency(total);
            document.getElementById('revenueTransCount').textContent = tableData.length.toLocaleString() + 'ê±´';
            document.getElementById('revenueAvgAmount').textContent = formatCurrency(avg);
        }

        // ========== í•„í„° ì—…ë°ì´íŠ¸ ==========
        function updateFilters() {
            // ë©¤ë²„ì‹­ í•„í„°ëŠ” ì´ì œ í•„ìš” ì—†ì§€ë§Œ HTML ìš”ì†Œê°€ ìˆìœ¼ë©´ ì´ˆê¸°í™”
            const membershipFilter = document.getElementById('membershipFilter');
            if (membershipFilter) {
                membershipFilter.innerHTML = '<option value="all">ì „ì²´</option>';
            }

            const companies = [...new Set(allData.consultant.map(r => r['company_name']).filter(Boolean))];
            const companyFilter = document.getElementById('consultantCompanyFilter');
            companyFilter.innerHTML = '<option value="all">ì „ì²´ íšŒì‚¬</option>' +
                companies.map(c => `<option value="${c}">${c}</option>`).join('');

            const products = [...new Set(allData.revenue.map(r => r['ìƒí’ˆ']).filter(Boolean))];
            const productFilter = document.getElementById('revenueProductFilter');
            productFilter.innerHTML = '<option value="all">ì „ì²´ ìƒí’ˆ</option>' +
                products.map(p => `<option value="${p}">${p}</option>`).join('');
        }

        // ========== ê²€ìƒ‰/í•„í„° í•¨ìˆ˜ ==========
        function filterMembership() {
            const searchTerm = document.getElementById('membershipSearch').value.toLowerCase();
            const filterValue = document.getElementById('membershipFilter').value;

            const filtered = allData.membership.filter(row => {
                const name = row['name'] || '';
                const mobile = row['mobile'] || '';
                const companyName = row['company_name'] || '';
                
                const matchSearch = !searchTerm || 
                    String(name).toLowerCase().includes(searchTerm) ||
                    String(mobile).includes(searchTerm) ||
                    String(companyName).toLowerCase().includes(searchTerm);
                return matchSearch;
            });

            updateMembershipTable(filtered);
        }

        function filterBranch() {
            const searchTerm = document.getElementById('branchSearch').value.toLowerCase();

            const filtered = allData.branch.filter(row => {
                const name = row['ì„±ëª…'] || '';
                const mobile = row['mobile'] || '';
                return !searchTerm || 
                    String(name).toLowerCase().includes(searchTerm) ||
                    String(mobile).includes(searchTerm);
            });

            updateBranchTable(filtered);
        }

        function filterCorporate() {
            const searchTerm = document.getElementById('corporateSearch').value.toLowerCase();

            const filtered = allData.corporate.filter(row => {
                const name = row['name'] || '';
                const companyName = row['company_name'] || '';
                const mobile = row['mobile'] || '';
                
                return !searchTerm || 
                    String(companyName).toLowerCase().includes(searchTerm) ||
                    String(name).toLowerCase().includes(searchTerm) ||
                    String(mobile).includes(searchTerm);
            });

            updateCorporateTable(filtered);
        }

        function filterConsultant() {
            const searchTerm = document.getElementById('consultantSearch').value.toLowerCase();
            const filterValue = document.getElementById('consultantCompanyFilter').value;

            const filtered = allData.consultant.filter(row => {
                const name = row['name'] || '';
                const companyName = row['company_name'] || '';
                const mobile = row['mobile'] || '';
                
                const matchSearch = !searchTerm || 
                    String(name).toLowerCase().includes(searchTerm) ||
                    String(companyName).toLowerCase().includes(searchTerm) ||
                    String(mobile).includes(searchTerm);
                const matchFilter = filterValue === 'all' || companyName === filterValue;
                return matchSearch && matchFilter;
            });

            updateConsultantTable(filtered);
        }

        function filterRevenue() {
            const searchTerm = document.getElementById('revenueSearch').value.toLowerCase();
            const filterValue = document.getElementById('revenueProductFilter').value;

            const filtered = allData.revenue.filter(row => {
                const matchSearch = !searchTerm || 
                    (row['ì„±ëª…'] || '').toLowerCase().includes(searchTerm) ||
                    (row['ìƒí’ˆ'] || '').toLowerCase().includes(searchTerm);
                const matchFilter = filterValue === 'all' || row['ìƒí’ˆ'] === filterValue;
                return matchSearch && matchFilter;
            });

            updateRevenueTable(filtered);
        }

        // ========== í†µí•© ê²€ìƒ‰ ==========
        function performGlobalSearch() {
            const searchTerm = document.getElementById('globalSearch').value.toLowerCase().trim();
            const resultsContainer = document.getElementById('globalSearchResults');

            if (!searchTerm) {
                resultsContainer.innerHTML = '<div class="empty-state">ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.</div>';
                return;
            }

            let html = '';

            // ë©¤ë²„ì‹­(ì´ë„ˆì„œí´) ê²€ìƒ‰
            const membershipResults = allData.membership.filter(row => 
                String(row['name'] || '').toLowerCase().includes(searchTerm) ||
                String(row['company_name'] || '').toLowerCase().includes(searchTerm)
            );
            if (membershipResults.length > 0) {
                html += `
                    <div class="result-group">
                        <div class="result-group-title">ğŸ¯ ì´ë„ˆì„œí´ íšŒì› (${membershipResults.length}ê±´)</div>
                        <div class="table-scroll" style="max-height: 200px;">
                            <table class="data-table">
                                <thead><tr><th>ì´ë¦„</th><th>íšŒì‚¬ëª…</th><th>ì „í™”ë²ˆí˜¸</th></tr></thead>
                                <tbody>
                                    ${membershipResults.map(row => `
                                        <tr>
                                            <td>${row['name'] || '-'}</td>
                                            <td>${row['company_name'] || '-'}</td>
                                            <td>${row['mobile'] || '-'}</td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>
                `;
            }

            // ì§€ì‚¬ ê²€ìƒ‰
            const branchResults = allData.branch.filter(row => 
                String(row['ì„±ëª…'] || '').toLowerCase().includes(searchTerm)
            );
            if (branchResults.length > 0) {
                html += `
                    <div class="result-group">
                        <div class="result-group-title">ğŸ¢ ì§€ì‚¬ (${branchResults.length}ê±´)</div>
                        <div class="table-scroll" style="max-height: 200px;">
                            <table class="data-table">
                                <thead><tr><th>ì„±ëª…</th><th>ëª¨ë°”ì¼</th></tr></thead>
                                <tbody>
                                    ${branchResults.map(row => `
                                        <tr>
                                            <td>${row['ì„±ëª…'] || '-'}</td>
                                            <td>${row['mobile'] || '-'}</td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>
                `;
            }

            // ê¸°ì—… ê²€ìƒ‰
            const corporateResults = allData.corporate.filter(row => 
                String(row['name'] || '').toLowerCase().includes(searchTerm) ||
                String(row['company_name'] || '').toLowerCase().includes(searchTerm)
            );
            if (corporateResults.length > 0) {
                html += `
                    <div class="result-group">
                        <div class="result-group-title">ğŸ›ï¸ ê¸°ì—… í™ˆí˜ì´ì§€ (${corporateResults.length}ê±´)</div>
                        <div class="table-scroll" style="max-height: 200px;">
                            <table class="data-table">
                                <thead><tr><th>íšŒì‚¬ëª…</th><th>ë‹´ë‹¹ì</th><th>ì „í™”ë²ˆí˜¸</th></tr></thead>
                                <tbody>
                                    ${corporateResults.map(row => `
                                        <tr>
                                            <td>${row['company_name'] || '-'}</td>
                                            <td>${row['name'] || '-'}</td>
                                            <td>${row['mobile'] || '-'}</td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>
                `;
            }

            // ì»¨ì„¤í„´íŠ¸ ê²€ìƒ‰
            const consultantResults = allData.consultant.filter(row => 
                String(row['name'] || '').toLowerCase().includes(searchTerm) ||
                String(row['company_name'] || '').toLowerCase().includes(searchTerm)
            );
            if (consultantResults.length > 0) {
                html += `
                    <div class="result-group">
                        <div class="result-group-title">ğŸ‘” ì»¨ì„¤í„´íŠ¸ (${consultantResults.length}ê±´)</div>
                        <div class="table-scroll" style="max-height: 200px;">
                            <table class="data-table">
                                <thead><tr><th>ì´ë¦„</th><th>íšŒì‚¬ëª…</th><th>ì „í™”ë²ˆí˜¸</th></tr></thead>
                                <tbody>
                                    ${consultantResults.map(row => `
                                        <tr>
                                            <td>${row['name'] || '-'}</td>
                                            <td>${row['company_name'] || '-'}</td>
                                            <td>${row['mobile'] || '-'}</td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>
                `;
            }

            // ë§¤ì¶œ ê²€ìƒ‰
            const revenueResults = allData.revenue.filter(row => 
                (row['ì„±ëª…'] || '').toLowerCase().includes(searchTerm)
            );
            if (revenueResults.length > 0) {
                const totalAmount = revenueResults.reduce((sum, row) => {
                    const amount = parseFloat(String(row['ì´ ê²°ì œê¸ˆì•¡\n(ì¹´ë“œë°ì†¡ê¸ˆ)'] || '0').replace(/[,ì›]/g, '')) || 0;
                    return sum + amount;
                }, 0);
                html += `
                    <div class="result-group">
                        <div class="result-group-title">ğŸ’° ë§¤ì¶œ (${revenueResults.length}ê±´, ì´ ${formatCurrency(totalAmount)})</div>
                        <div class="table-scroll" style="max-height: 200px;">
                            <table class="data-table">
                                <thead><tr><th>ì¼ì</th><th>ì„±ëª…</th><th>ìƒí’ˆ</th><th>ê²°ì œê¸ˆì•¡</th></tr></thead>
                                <tbody>
                                    ${revenueResults.map(row => `
                                        <tr>
                                            <td>${formatDateValue(row['ì¼ì'])}</td>
                                            <td>${row['ì„±ëª…'] || '-'}</td>
                                            <td>${row['ìƒí’ˆ'] || '-'}</td>
                                            <td class="money">${formatCurrency(row['ì´ ê²°ì œê¸ˆì•¡\n(ì¹´ë“œë°ì†¡ê¸ˆ)'] || 0)}</td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>
                `;
            }

            if (!html) {
                html = '<div class="empty-state">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
            }

            resultsContainer.innerHTML = html;
        }

        // ========== ì°¨íŠ¸ ì—…ë°ì´íŠ¸ ==========
        function updateCharts() {
            // íšŒì› ë¶„í¬ ì°¨íŠ¸
            const memberDistCtx = document.getElementById('memberDistChart').getContext('2d');
            if (charts.memberDist) charts.memberDist.destroy();
            charts.memberDist = new Chart(memberDistCtx, {
                type: 'doughnut',
                data: {
                    labels: ['ë©¤ë²„ì‹­', 'ì§€ì‚¬', 'ê¸°ì—…', 'ì»¨ì„¤í„´íŠ¸'],
                    datasets: [{
                        data: [
                            allData.membership.length,
                            allData.branch.length,
                            allData.corporate.length,
                            allData.consultant.length
                        ],
                        backgroundColor: ['#e74c3c', '#3498db', '#9b59b6', '#27ae60'],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: { color: '#555', padding: 15, font: { size: 12 } }
                        }
                    }
                }
            });

            // ì›”ë³„ ë§¤ì¶œ ì°¨íŠ¸
            const revenueCtx = document.getElementById('revenueChart').getContext('2d');
            if (charts.revenue) charts.revenue.destroy();
            
            const monthlyRevenue = {};
            allData.revenue.forEach(row => {
                const date = row['ì¼ì'];
                if (date) {
                    let month;
                    if (typeof date === 'string') {
                        const match = date.match(/(\d{4})[.-]?(\d{2})/);
                        if (match) month = `${match[1]}-${match[2]}`;
                    }
                    if (month) {
                        const amount = parseFloat(String(row['ì´ ê²°ì œê¸ˆì•¡\n(ì¹´ë“œë°ì†¡ê¸ˆ)'] || '0').replace(/[,ì›]/g, '')) || 0;
                        monthlyRevenue[month] = (monthlyRevenue[month] || 0) + amount;
                    }
                }
            });

            const sortedMonths = Object.keys(monthlyRevenue).sort();
            charts.revenue = new Chart(revenueCtx, {
                type: 'line',
                data: {
                    labels: sortedMonths.length > 0 ? sortedMonths : ['ë°ì´í„° ì—†ìŒ'],
                    datasets: [{
                        label: 'ì›”ë³„ ë§¤ì¶œ',
                        data: sortedMonths.length > 0 ? sortedMonths.map(m => monthlyRevenue[m]) : [0],
                        borderColor: '#f39c12',
                        backgroundColor: 'rgba(243, 156, 18, 0.1)',
                        fill: true,
                        tension: 0.4,
                        pointBackgroundColor: '#f39c12',
                        pointRadius: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: { color: '#888' },
                            grid: { color: '#eee' }
                        },
                        x: {
                            ticks: { color: '#888' },
                            grid: { color: '#eee' }
                        }
                    }
                }
            });

            // ìƒí’ˆë³„ ë§¤ì¶œ ì°¨íŠ¸
            const productCtx = document.getElementById('productChart').getContext('2d');
            if (charts.product) charts.product.destroy();
            
            const productRevenue = {};
            allData.revenue.forEach(row => {
                const product = row['ìƒí’ˆ'] || 'ê¸°íƒ€';
                const amount = parseFloat(String(row['ì´ ê²°ì œê¸ˆì•¡\n(ì¹´ë“œë°ì†¡ê¸ˆ)'] || '0').replace(/[,ì›]/g, '')) || 0;
                productRevenue[product] = (productRevenue[product] || 0) + amount;
            });

            const productLabels = Object.keys(productRevenue);
            const productData = productLabels.map(p => productRevenue[p]);
            const productColors = ['#e74c3c', '#3498db', '#2ecc71', '#f39c12', '#9b59b6', '#1abc9c', '#e67e22'];

            charts.product = new Chart(productCtx, {
                type: 'pie',
                data: {
                    labels: productLabels.length > 0 ? productLabels : ['ë°ì´í„° ì—†ìŒ'],
                    datasets: [{
                        data: productData.length > 0 ? productData : [1],
                        backgroundColor: productColors,
                        borderWidth: 2,
                        borderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right',
                            labels: { color: '#555', font: { size: 11 }, padding: 10 }
                        }
                    }
                }
            });

            // ê²°ì œìœ í˜•ë³„ ì°¨íŠ¸
            const paymentCtx = document.getElementById('paymentTypeChart').getContext('2d');
            if (charts.payment) charts.payment.destroy();
            
            const paymentType = {};
            allData.revenue.forEach(row => {
                const type = row['ê²°ì œìœ í˜•'] || 'ê¸°íƒ€';
                const amount = parseFloat(String(row['ì´ ê²°ì œê¸ˆì•¡\n(ì¹´ë“œë°ì†¡ê¸ˆ)'] || '0').replace(/[,ì›]/g, '')) || 0;
                paymentType[type] = (paymentType[type] || 0) + amount;
            });

            const paymentLabels = Object.keys(paymentType);
            const paymentData = paymentLabels.map(p => paymentType[p]);

            charts.payment = new Chart(paymentCtx, {
                type: 'bar',
                data: {
                    labels: paymentLabels.length > 0 ? paymentLabels : ['ë°ì´í„° ì—†ìŒ'],
                    datasets: [{
                        label: 'ê²°ì œê¸ˆì•¡',
                        data: paymentData.length > 0 ? paymentData : [0],
                        backgroundColor: '#3498db',
                        borderRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: { color: '#888' },
                            grid: { color: '#eee' }
                        },
                        x: {
                            ticks: { color: '#888' },
                            grid: { display: false }
                        }
                    }
                }
            });
        }

        // ========== ì •ë ¬ ê¸°ëŠ¥ ==========
        let sortState = {
            membership: { column: null, order: 'asc' },
            branch: { column: null, order: 'asc' },
            corporate: { column: null, order: 'asc' },
            consultant: { column: null, order: 'asc' },
            revenue: { column: null, order: 'asc' }
        };

        function sortTable(tableType, column) {
            const state = sortState[tableType];
            
            // ê°™ì€ ì»¬ëŸ¼ í´ë¦­ ì‹œ ì •ë ¬ ìˆœì„œ í† ê¸€
            if (state.column === column) {
                state.order = state.order === 'asc' ? 'desc' : 'asc';
            } else {
                state.column = column;
                state.order = 'asc';
            }

            // ë°ì´í„° ì •ë ¬
            const data = [...allData[tableType]];
            
            data.sort((a, b) => {
                let valA, valB;
                
                // ì»¬ëŸ¼ë³„ ê°’ ì¶”ì¶œ
                switch(tableType) {
                    case 'membership':
                        if (column === 'name') { valA = a['name'] || ''; valB = b['name'] || ''; }
                        else if (column === 'company') { valA = a['company_name'] || ''; valB = b['company_name'] || ''; }
                        else if (column === 'mobile') { valA = a['mobile'] || ''; valB = b['mobile'] || ''; }
                        else if (column === 'promotion') { valA = a['promotion'] || ''; valB = b['promotion'] || ''; }
                        break;
                    case 'branch':
                        if (column === 'name') { valA = a['ì„±ëª…'] || ''; valB = b['ì„±ëª…'] || ''; }
                        else if (column === 'mobile') { valA = a['mobile'] || ''; valB = b['mobile'] || ''; }
                        break;
                    case 'corporate':
                        if (column === 'company') { valA = a['company_name'] || ''; valB = b['company_name'] || ''; }
                        else if (column === 'name') { valA = a['name'] || ''; valB = b['name'] || ''; }
                        else if (column === 'mobile') { valA = a['mobile'] || ''; valB = b['mobile'] || ''; }
                        else if (column === 'promotion') { valA = a['promotion'] || ''; valB = b['promotion'] || ''; }
                        break;
                    case 'consultant':
                        if (column === 'name') { valA = a['name'] || ''; valB = b['name'] || ''; }
                        else if (column === 'company') { valA = a['company_name'] || ''; valB = b['company_name'] || ''; }
                        else if (column === 'mobile') { valA = a['mobile'] || ''; valB = b['mobile'] || ''; }
                        else if (column === 'promotion') { valA = a['promotion'] || ''; valB = b['promotion'] || ''; }
                        break;
                    case 'revenue':
                        if (column === 'date') { valA = a['ì¼ì'] || ''; valB = b['ì¼ì'] || ''; }
                        else if (column === 'name') { valA = a['ì„±ëª…'] || ''; valB = b['ì„±ëª…'] || ''; }
                        else if (column === 'type') { valA = a['ê²°ì œìœ í˜•'] || ''; valB = b['ê²°ì œìœ í˜•'] || ''; }
                        else if (column === 'product') { valA = a['ìƒí’ˆ'] || ''; valB = b['ìƒí’ˆ'] || ''; }
                        else if (column === 'amount') { 
                            valA = parseFloat(String(a['ì´ ê²°ì œê¸ˆì•¡\n(ì¹´ë“œë°ì†¡ê¸ˆ)'] || '0').replace(/[,ì›]/g, '')) || 0;
                            valB = parseFloat(String(b['ì´ ê²°ì œê¸ˆì•¡\n(ì¹´ë“œë°ì†¡ê¸ˆ)'] || '0').replace(/[,ì›]/g, '')) || 0;
                        }
                        break;
                }
                
                // ìˆ«ìì¸ ê²½ìš°
                if (typeof valA === 'number' && typeof valB === 'number') {
                    return state.order === 'asc' ? valA - valB : valB - valA;
                }
                
                // ë¬¸ìì—´ì¸ ê²½ìš°
                valA = String(valA).toLowerCase();
                valB = String(valB).toLowerCase();
                
                if (state.order === 'asc') {
                    return valA.localeCompare(valB, 'ko');
                } else {
                    return valB.localeCompare(valA, 'ko');
                }
            });

            // í…Œì´ë¸” ì—…ë°ì´íŠ¸
            switch(tableType) {
                case 'membership': updateMembershipTable(data); break;
                case 'branch': updateBranchTable(data); break;
                case 'corporate': updateCorporateTable(data); break;
                case 'consultant': updateConsultantTable(data); break;
                case 'revenue': updateRevenueTable(data); break;
            }

            // í—¤ë” ìŠ¤íƒ€ì¼ ì—…ë°ì´íŠ¸
            updateSortHeader(tableType, column, state.order);
        }

        function updateSortHeader(tableType, column, order) {
            const tableId = tableType + 'Table';
            const table = document.getElementById(tableId);
            if (!table) return;

            // ëª¨ë“  í—¤ë”ì—ì„œ ì •ë ¬ í´ë˜ìŠ¤ ì œê±°
            table.querySelectorAll('th').forEach(th => {
                th.classList.remove('sort-asc', 'sort-desc');
            });

            // í˜„ì¬ ì •ë ¬ ì»¬ëŸ¼ì— í´ë˜ìŠ¤ ì¶”ê°€
            const headerIndex = getHeaderIndex(tableType, column);
            const th = table.querySelectorAll('th')[headerIndex];
            if (th) {
                th.classList.add(order === 'asc' ? 'sort-asc' : 'sort-desc');
            }
        }

        function getHeaderIndex(tableType, column) {
            const indexMap = {
                membership: { no: 0, name: 1, company: 2, mobile: 3, promotion: 4 },
                branch: { no: 0, name: 1, mobile: 2 },
                corporate: { no: 0, company: 1, name: 2, mobile: 3, promotion: 4 },
                consultant: { no: 0, name: 1, company: 2, mobile: 3, promotion: 4 },
                revenue: { no: 0, date: 1, name: 2, type: 3, product: 4, amount: 5 }
            };
            return indexMap[tableType]?.[column] ?? 0;
        }

        // ========== ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ ==========
        function formatCurrency(value) {
            const num = parseFloat(String(value).replace(/[,ì›]/g, '')) || 0;
            if (num >= 100000000) {
                return (num / 100000000).toFixed(1) + 'ì–µì›';
            } else if (num >= 10000) {
                return (num / 10000).toFixed(0) + 'ë§Œì›';
            }
            return num.toLocaleString('ko-KR') + 'ì›';
        }

        // ========== ì—”í„°í‚¤ ê²€ìƒ‰ ==========
        document.querySelectorAll('.search-input').forEach(input => {
            input.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    const btn = input.parentElement.querySelector('.search-btn');
                    if (btn) btn.click();
                }
            });
        });

        // ========== ì´ˆê¸°í™” ==========
        document.addEventListener('DOMContentLoaded', loadAllData);

        // 5ë¶„ë§ˆë‹¤ ìë™ ìƒˆë¡œê³ ì¹¨
        setInterval(loadAllData, 5 * 60 * 1000);
    </script>
</body>
</html>
